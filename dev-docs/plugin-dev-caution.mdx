import BelowDocument
  from "../src/components/BelowDocument";


# プラグイン開発時の注意

あなたのプラグインを KPM で最大限活用するための注意点について説明しています。

---

## プラグインのバージョニング

KPM を使用する上で、 プラグインのアップグレードや依存関係の解決など、プラグインのバージョンが重要な場面が多数あります。  
バージョニングには様々な記法・表現方法 がありますが、バージョンを統一して管理するために、 [Semantic Versioning](https://semver.org/lang/ja/) という規約が世界的に使われています。  
KPM ではこのバージョン記法のみをサポートしています。 そのため、 プラグインのバージョニングは [Semantic Versioning](https://semver.org/lang/ja/) に準拠することを推奨します。
これは、 プラグインのリリースのタグでも同様です。 GitHub でプラグインをリリースする場合、バージョングはこの記法に合わせると良いでしょう。

### v接頭辞について

[この記述](https://semver.org/lang/ja/#v123はセマンティック-バージョンでしょうか)の通り、 `v` 接頭辞は [Semantic Versioning](https://semver.org/lang/ja/) には含まれません。  
ですが、多くの場合バージョンに `v` をつけることが慣習となっています。そのため、 KPM はバージョンの先頭の `v` を無視します。

#### 例

+ `v1.2.3` と `1.2.3` は同じバージョンとして扱われます。
+ `v1.2.3` と `v1.2.3-beta.1` は同じバージョンとして扱われません。
+ `v1.2.3` と `1.2.3-beta.1` は同じバージョンとして扱われません。

### パッチバージョンの省略

v接頭辞の場合と同様、 [Semantic Versioning](https://semver.org/lang/ja/) はパッチ・バージョン（1.0.X）の省略を許可しておらず、
これが省略されたバージョンは [Semantic Versioning](https://semver.org/lang/ja/) に準拠していないとみなされます。  
ですが、パッチ・バージョンを省略することが極稀に見られるため、 KPM は **パッチ・バージョンの省略を許容する**とともに、**省略した場合は `0` とみなします**。

#### 例

+ `1.2.0` と `1.2` は同じバージョンとして扱われます。
+ `1.2.0` と `1.2-beta.1` は同じバージョンとして扱われません。
+ `1.2.0` と `1.2.0-beta.1` は同じバージョンとして扱われません。

## カスタムレシピを適切に管理する

[PaperMC](https://papermc.io/) は、プラグインのアンロード時に、そのプラグインが登録したレシピを自動で削除しません。
そのため、アンインストール時には KPM がレシピを削除します。
KPM は、プラグインのアンロード時にレシピを全て削除しようとしますが、プラグインが予期しない名前空間のレシピを使用している場合、うまく動作しない場合があります。
この問題を解決して適切にレシピを削除するために、プラグインが使用するレシピまたはその名前空間を、 [KPM 情報ファイル](/dev-docs/api/kpm-info)に記述してください。

:::tip 記述しなくてよいレシピ・名前空間

以下のような名前空間をレシピを作成する際に使用すると、KPM が自動でレシピを認識します。そのため、明示的に記述する必要はありません。

+ プラグインの名前（大小問わず）の名前空間
+ `new NamespacedKey(<プラグインのインスタンス>, "hoge")` で作成した完全修飾キー
  この場合、名前空間にはプラグインの名前が使用されるので一番上の条件に当てはまります。

:::

<BelowDocument docId={"api/kpm-info"} anchor={"プラグインのカスタムレシピ"} /> 

## リポジトリ名とプラグイン名を一致させる

KPM は、依存関係の解決時に、 GitHub のリポジトリを検索します。  
このときに検索される項目は依存関係のプラグイン名なので、依存関係として使用されることが想定されるプラグインは、リポジトリ名とプラグイン名を一致させることをおすすめします。

:::tip

一般に一部の例外を除いて、プラグイン名とリポジトリ名を一致することがデファクトスタンダードとなっています。    
例外として、プラグイン名に空白が含まれるプラグインは、[KPM 情報ファイル](/dev-docs/api/kpm-info#依存先プラグインの解決クエリ)に明示的に取得元を記述することで依存関係を適切に解決できます。
